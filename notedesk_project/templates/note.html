<!--  наследуемся от шаблона default.html, который мы создавали для flatpages -->
{% extends 'flatpages/default.html' %}

{% load custom_filters %}
<!-- Подключаем новый файл с нашим тегом -->
{% load custom_tags %}

<!--{% load i18n %}-->

{% block content %}


<style>
   button {
    background: greenyellow; /* Цвет фона */
    color: darkblue; /* Цвет текста */
    width: 180px;
    padding: 5px; /* Поля вокруг текста */
    border-radius: 10px; /* Уголки */
   }
</style>
<br>
    <div>
        <a href="{% url 'notes' %}">
                <h5 style="font-size: 15px; font-family: Times, serif; color: grey">
                        <button>All Notes</button>
                </h5>
        </a>
    </div>

<hr>

<h2 style="text-align: left;">
    <em>{{ note.author }}</em>
</h2>

<h6 style="text-align: left;">
    <em>{{ note.time_in}}</em>
</h6>

{# Теперь будем проверять не request.user.is_authenticated, а конкретные права #}
<div>
        <div class="nav">
        {% if perms.notes.change_note %}
            {% if note.author == request.user %}
                    <a href="{% url 'note_edit' pk=note.id %}">
                    <h5 style="font-size: 15px; font-family: Times, serif; color: grey";>
                        <button>Изменить</button></h5>
                    </a>
            {% endif %}
        {% endif %}
        </div>

        <div class="nav">

        {% if perms.notes.delete_note %}
            {% if note.author == request.user %}
                    <a href="{% url 'note_delete' note.id %}">
                        <h5 style="font-size: 15px; font-family: Times, serif; color: grey">
                            <button>Удалить</button></h5>
                    </a>
            {% endif %}
        {% endif %}

        </div>
</div>
    {% if note.image %}
        <div>
        <img src="{{ note.image.url }}" width="200" style="horiz-align: left">

        </div>

        {% endif %}
    <h5 style="text-align: left;">

    {{ note.note|linebreaks }}
    <p>
        <!-- Все могут видеть количество откликов на статью, если они есть -->

        <h5 style="text-align: left;">Количество откликов на статью: {{no_of_replies}}</h5>

    </p>

    <hr>

    </h5>
    <div>
    <!--Блок Отклики на статью может видеть только авторизованный пользоватеь   -->
    {% if user.is_authenticated %}
        <h2> Отклики </h2>
        <!--Отклики на статью может видеть только автор статьи : проверка на владельца статьи  -->
        {% if request.user == note.author %}
            {% if no_of_replies %}

                <hr>
                <!-- present the list of replies -->
                {% for reply in replies %}
                    <div>
                        {% if reply.accept %}
                        <h4 style="color: green">{{reply.replier}} | {{reply.reply|truncatechars:64}} | Accepted</h4>
                        {% else %}
                        <h4 style="color: red">{{reply.replier}} | {{reply.reply|truncatechars:64}} | Not Accepted</h4>
                        {% endif %}
                    </div>

                {% endfor %}
            {% else %}
            <h2> Откликов нет </h2>
            {% endif %}
        <!-- if authorized user is not the author of note then he or she could see own reply if exist or add reply if not-->
        {% else %}
            {% for reply in replies %}

                {% if reply.replier == request.user %}
                    <div>
                        {% if reply.accept %}
                            <h4 style="color: green">{{reply.replier}} | {{reply.reply|truncatechars:64}} | Accepted</h4>
                        {% else %}
                            <h4 style="color: red">{{reply.replier}} | {{reply.reply|truncatechars:64}} | Not Accepted</h4>
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}

            <!--And give form for reply creation if there is no any unaccepted replies--->

            {% if not no_of_replies %}
                <form action="" method="POST" id="id_content" >
                    <div>
                      <label for="reply_form">Ваш отклик</label>
                       {{ reply_form.reply }} {% csrf_token %} <input type="submit" value="Разместить">
                    </div>
                </form>
            {% else %}

                {% if not showreplyform %}
                    <form action="" method="POST" id="id_content" >
                        <div>
                          <label for="reply_form">Ваш отклик</label>
                           {{ reply_form.reply }} {% csrf_token %} <input type="submit" value="Разместить">
                        </div>
                    </form>
                {% endif %}
            {% endif %}

        {% endif %}
    {% else %}
        <!--пользователь не авторизован значит на вывод вывод кнопкой на авторизацию-->
        <div>
            <h5>Чтобы сделать отклик на объявление необходимо</h5>
            <a href="/accounts/login/">
                <h5 style="font-size: 15px; font-family: Times, serif; color: grey">
                    <button>Зарегистрироваться</button></h5>
            </a>
        </div>

    {% endif %}
    </div>

{% endblock content %}

